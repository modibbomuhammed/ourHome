<% layout('layouts/boilerplate') -%>

<% block('head').append('<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">') %>

<% block('head').append('<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>') %>

<% block('head').append('<link rel="stylesheet" href="/stylesheets/showPage.css" />') %>

<% include ../partials/navbar %>

<div class='row'>
	<div class='col-md-4'>
		<div id="map"></div>		
	</div>
	
	<section class='col-md-8'>
		<div id='myRow'>
			<h3><%= home.bedrooms %> Bedroom Property For <%= home.lease.toLowerCase() %></h3>
			<address><i class='fas fa-map-marker-alt'></i>  <%= home.location %></address>
		</div>
		
		<div>
			<div id='pictures-box'> Below are pictures of the property:
					
				<div class='slidershow middle'>
					<div class='slides'>
						
						<% for(x = 0; x < home.pictures.length; x++) { %>		
							<input type='radio' name='r' id='r<%= x %>' <%= x === 0 ? 'checked' : '' %>>
						<% } %>

						<% home.pictures.forEach((photo, index) => { %>

							<div class='slide <%= index === 0 ? 's1': '' %>'><img src='<%= photo.url %>'></div>
						<% }) %>
							
					</div>
						
						
					<div class='navigation'>
						<% home.pictures.forEach((photo,index) => { %>
							<label for='r<%= index %>' class='bar'></label>
						<% }) %>
					</div>
						
				</div>
			</div>
		</div>
		
		
	</section>
	
	
	
	<%= home.state %> State
			<ul>
				<li> location at </li>
				<li> Going for </li>
				<li>  bedrooms property costing N<%= home.price %></li>
				<li><a href='/homes/<%= home.id %>/edit' class='btn btn-primary'>EDIT</a><form style='display: inline'action='/homes/<%= home.id %>?_method=DELETE' method='POST'><button class='btn btn-danger'>DELETE(Warning you can't retrieve this data)</button></form></li>
				
			</ul>
	
	

<div class="carousel-container">
      <i class="fas fa-arrow-left" id="prevBtn"></i>
      <i class="fas fa-arrow-right" id="nextBtn"></i>
      <div class="carousal-slide" id='put-pictures'>
		  <% home.pictures.forEach((pic, index) => { %>
			 <img src='<%= pic.url %>' alt='<%- `pic${index}` %>'> 
		  <% }) %>
        <!-- <img src="./test-pictures/3.png" id="last-clone" alt="" />
        <img src="./test-pictures/1.png" alt="" />
        <img src="./test-pictures/2.png" alt="" />
        <img src="./test-pictures/3.png" alt="" />
        <img src="./test-pictures/1.png" id="first-clone" alt="" /> -->
      </div>
</div>

<script>
    //   var map;
    //   function initMap() {
    //     map = new google.maps.Map(document.getElementById('map'), {
    //       center: {lat: <%= home.lat %>, lng: <%= home.lng %>},
    //       zoom: 13
    //     });
	//   }
	const {lat, lng} = <%- JSON.stringify(home) %>
	const myMap = L.map('map').setView([lat, lng], 13);;

	L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox/streets-v11',
    tileSize: 512,
    zoomOffset: -1,
    accessToken: 'pk.eyJ1IjoibW9kaWJib211aGFtbWVkIiwiYSI6ImNrN2o4bW1rajA5cnEzZXJ3Z2tjcHh0eG4ifQ.HhXWW8u_prQskpDfMM_43g'
}).addTo(myMap);

</script>


<!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB3y4rA9gEGJe40UAFr0YOlqp-7VkpoUjI&callback=initMap"
    async defer></script> -->

<script>
	const home = <%- JSON.stringify(home) %>
	const length = home.pictures.length;
	const firstClone = home.pictures[0].url;
	const lastClone = home.pictures[length - 1].url
	const carousal = document.getElementById('put-pictures');
	const firstImage = document.createElement('img');
	const lastImage = document.createElement('img');
	firstImage.setAttribute('src', lastClone)
	firstImage.setAttribute('id', 'lastClone')
	lastImage.setAttribute('src', firstClone)
	lastImage.setAttribute('id', 'firstClone')
	carousal.prepend(firstImage)
	carousal.appendChild(lastImage)
</script>
	
<script src="/javascripts/imageSlider.js"></script>